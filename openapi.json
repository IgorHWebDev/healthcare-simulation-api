  {
  "openapi": "3.1.0",
  "info": {
    "title": "Healthcare Simulation API",
    "description": "API for healthcare simulation with integrated medical LLM model (phi_lora_3b_medical_healthcaremagic_gguf)",
    "version": "0.2.0",
    "contact": {
      "name": "Healthcare Simulation Team",
      "url": "https://healthcare-simulation-api.onrender.com"
    }
  },
  "servers": [
    {
      "url": "https://healthcare-simulation-api.onrender.com",
      "description": "Production API Server"
    }
  ],
  "paths": {
    "/v1/healthcare/simulate": {
      "post": {
        "summary": "Simulate healthcare scenario",
        "description": "Process a healthcare simulation scenario using advanced medical LLM model",
        "operationId": "simulate_healthcare_scenario",
        "tags": ["Healthcare Simulation"],
        "security": [
          {
            "APIKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SimulationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful simulation response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SimulationResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid API key",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error or medical LLM model error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/v1/healthcare/validate": {
      "post": {
        "summary": "Validate healthcare protocol",
        "description": "Validate a healthcare protocol against established guidelines",
        "operationId": "validate_protocol",
        "tags": ["Healthcare Simulation"],
        "security": [
          {
            "APIKeyHeader": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful validation response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid API key",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health check",
        "description": "Check the health status of the API and its components",
        "operationId": "health_check",
        "tags": ["System"],
        "responses": {
          "200": {
            "description": "System is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["healthy", "unhealthy"]
                    },
                    "components": {
                      "type": "object",
                      "properties": {
                        "api": {
                          "type": "string",
                          "enum": ["up", "down"]
                        },
                        "database": {
                          "type": "string",
                          "enum": ["up", "down"]
                        },
                        "medical_llm": {
                          "type": "string",
                          "enum": ["up", "down"]
                        }
                      }
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/healthcare/model/test": {
      "get": {
        "tags": ["Healthcare"],
        "summary": "Test Medical LLM Model Connection",
        "description": "Tests the connection to the medical LLM model and returns model information and M3 optimization status",
        "operationId": "test_model_connection",
        "responses": {
          "200": {
            "description": "Successful connection to the model",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "connected"
                    },
                    "model_endpoint": {
                      "type": "string",
                      "example": "http://10.100.102.100:1234"
                    },
                    "model_name": {
                      "type": "string",
                      "example": "phi_lora_3b_medical_healthcaremagic_gguf"
                    },
                    "model_info": {
                      "type": "object",
                      "description": "Additional model information"
                    },
                    "m3_optimization": {
                      "type": "object",
                      "properties": {
                        "metal_enabled": {
                          "type": "boolean",
                          "example": true
                        },
                        "compute_units": {
                          "type": "string",
                          "example": "all"
                        },
                        "precision": {
                          "type": "string",
                          "example": "float16"
                        }
                      }
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable - Model endpoint is not responding",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "detail": {
                      "type": "string",
                      "example": "Error connecting to model: Connection refused"
                    }
                  }
                }
              }
            }
          },
          "504": {
            "description": "Gateway Timeout - Connection to model timed out",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "detail": {
                      "type": "string",
                      "example": "Connection to model timed out"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "PatientStatus": {
        "type": "string",
        "enum": ["יציב", "לא יציב", "קריטי"],
        "description": "Patient status in Hebrew"
      },
      "ProtocolType": {
        "type": "string",
        "enum": ["ACLS", "BLS", "PALS", "TRAUMA"],
        "description": "Type of medical protocol"
      },
      "VitalSigns": {
        "type": "object",
        "properties": {
          "heart_rate": {
            "type": "object",
            "properties": {
              "value": {
                "type": "number"
              },
              "unit": {
                "type": "string"
              }
            }
          },
          "blood_pressure": {
            "type": "object",
            "properties": {
              "systolic": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "number"
                  },
                  "unit": {
                    "type": "string"
                  }
                }
              },
              "diastolic": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "number"
                  },
                  "unit": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "respiratory_rate": {
            "type": "object",
            "properties": {
              "value": {
                "type": "number"
              },
              "unit": {
                "type": "string"
              }
            }
          },
          "temperature": {
            "type": "object",
            "properties": {
              "value": {
                "type": "number"
              },
              "unit": {
                "type": "string"
              }
            }
          },
          "oxygen_saturation": {
            "type": "object",
            "properties": {
              "value": {
                "type": "number"
              },
              "unit": {
                "type": "string"
              }
            }
          }
        }
      },
      "Action": {
        "type": "object",
        "required": ["action", "details"],
        "properties": {
          "action": {
            "type": "string",
            "description": "Action to be taken"
          },
          "details": {
            "type": "string",
            "description": "Detailed description of the action"
          },
          "references": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Reference materials"
          },
          "vital_signs": {
            "$ref": "#/components/schemas/VitalSigns"
          }
        }
      },
      "Step": {
        "type": "object",
        "required": ["step", "description", "actions"],
        "properties": {
          "step": {
            "type": "integer",
            "description": "Step number"
          },
          "description": {
            "type": "string",
            "description": "Step description"
          },
          "actions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Action"
            }
          }
        }
      },
      "SimulationRequest": {
        "type": "object",
        "properties": {
          "scenario": {
            "type": "string",
            "description": "Healthcare scenario to simulate",
            "example": "Patient presents with chest pain and shortness of breath"
          },
          "patient_data": {
            "type": "object",
            "properties": {
              "age": {
                "type": "integer",
                "description": "Patient age in years",
                "example": 65
              },
              "gender": {
                "type": "string",
                "enum": ["male", "female", "other"],
                "example": "male"
              },
              "vital_signs": {
                "type": "object",
                "properties": {
                  "heart_rate": {
                    "type": "object",
                    "properties": {
                      "value": {
                        "type": "number",
                        "example": 85
                      },
                      "unit": {
                        "type": "string",
                        "example": "bpm"
                      }
                    }
                  },
                  "blood_pressure": {
                    "type": "object",
                    "properties": {
                      "systolic": {
                        "type": "object",
                        "properties": {
                          "value": {
                            "type": "number",
                            "example": 140
                          },
                          "unit": {
                            "type": "string",
                            "example": "mmHg"
                          }
                        }
                      },
                      "diastolic": {
                        "type": "object",
                        "properties": {
                          "value": {
                            "type": "number",
                            "example": 90
                          },
                          "unit": {
                            "type": "string",
                            "example": "mmHg"
                          }
                        }
                      }
                    }
                  },
                  "respiratory_rate": {
                    "type": "object",
                    "properties": {
                      "value": {
                        "type": "number",
                        "example": 18
                      },
                      "unit": {
                        "type": "string",
                        "example": "breaths/min"
                      }
                    }
                  },
                  "temperature": {
                    "type": "object",
                    "properties": {
                      "value": {
                        "type": "number",
                        "example": 37.2
                      },
                      "unit": {
                        "type": "string",
                        "example": "°C"
                      }
                    }
                  },
                  "oxygen_saturation": {
                    "type": "object",
                    "properties": {
                      "value": {
                        "type": "number",
                        "example": 96
                      },
                      "unit": {
                        "type": "string",
                        "example": "%"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "required": ["scenario"]
      },
      "SimulationResponse": {
        "type": "object",
        "properties": {
          "diagnosis": {
            "type": "string",
            "description": "Preliminary diagnosis based on scenario",
            "example": "Suspected acute coronary syndrome"
          },
          "recommended_actions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of recommended actions",
            "example": [
              "Administer aspirin 325mg",
              "Obtain 12-lead ECG",
              "Start oxygen therapy"
            ]
          },
          "vital_signs": {
            "type": "object",
            "description": "Current vital signs with trends",
            "properties": {
              "current": {
                "$ref": "#/components/schemas/VitalSigns"
              },
              "trends": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/VitalSigns"
                }
              }
            }
          },
          "risk_assessment": {
            "type": "string",
            "description": "Risk assessment based on scenario",
            "example": "High risk for acute cardiac event"
          },
          "next_steps": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Recommended next steps",
            "example": [
              "Arrange immediate transfer to cardiac catheterization lab",
              "Monitor vital signs every 5 minutes",
              "Prepare for possible intervention"
            ]
          }
        }
      },
      "ValidationRequest": {
        "type": "object",
        "properties": {
          "protocol": {
            "type": "string",
            "description": "Healthcare protocol to validate",
            "example": "ACLS chest pain protocol"
          },
          "steps": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Steps in the protocol",
            "example": [
              "Assess airway and breathing",
              "Obtain vital signs",
              "Administer aspirin"
            ]
          }
        },
        "required": ["protocol", "steps"]
      },
      "ValidationResponse": {
        "type": "object",
        "properties": {
          "is_valid": {
            "type": "boolean",
            "description": "Whether the protocol is valid"
          },
          "score": {
            "type": "number",
            "description": "Validation score (0-100)",
            "minimum": 0,
            "maximum": 100
          },
          "feedback": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Feedback on protocol steps"
          },
          "references": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Relevant medical references"
          }
        }
      },
      "Error": {
        "type": "object",
        "required": ["code", "message"],
        "properties": {
          "code": {
            "type": "string",
            "description": "Error code"
          },
          "message": {
            "type": "string",
            "description": "Error message"
          }
        }
      }
    },
    "securitySchemes": {
      "APIKeyHeader": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key"
      }
    }
  }
}